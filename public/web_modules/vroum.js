/* esm.sh - esbuild bundle(vroum@0.0.23) es2022 production */
var F=Object.defineProperty,K=(s,t,e)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,m=(s,t,e)=>(K(s,typeof t!="symbol"?t+"":t,e),e),k=class{constructor(){m(this,"events",{})}dispatch(t,...e){if(this.events[t])for(let i of this.events[t])i.call(this,this,...e)}subscribe(t,e){this.events[t]||(this.events[t]=[]),!(this.events[t].indexOf(e)>=0)&&this.events[t].push(e)}unsubscribe(t,e){if(!this.events[t])return;if(!e){this.events[t].length=0;return}let i=this.events[t].indexOf(e);this.events[t].splice(i,1)}},c=class extends k{constructor(t,e){super(),m(this,"updatedProps",{}),m(this,"parent"),m(this,"children",[]),m(this,"willMount",!1),m(this,"willUpdate",!1),m(this,"willTick",!1),m(this,"willDestroy",!1),this.props=t,this.children=e??[]}static ref(){return{ref:void 0}}beforeMount(){var t;(t=this.props)!=null&&t.ref&&(this.props.ref.ref=this)}afterDestroy(){var t;(t=this.props)!=null&&t.ref&&(this.props.ref.ref=void 0),H(this),this.parent=void 0,this.events={},this.props=void 0}is(t){return t?typeof t=="string"?this.constructor.name===t:this instanceof t:!0}get(t){for(let e of this.children)if(e.is(t))return e}getAll(t){let e=[];for(let i of this.children)i.is(t)&&e.push(i);return e}find(t){for(let e of this.children){if(e.is(t))return e;let i=e.find(t);if(i)return i}}findAll(t,e){e=e??[];for(let i of this.children)i.is(t)&&e.push(i),i.findAll(t,e);return e}closest(t){var e;return(e=this.parent)!=null&&e.is(t)?this.parent:this.parent?this.parent.closest(t):void 0}add(...t){for(let e of t)e.connect(this)}remove(...t){for(let e of t)e.disconnect()}set(t){this.updatedProps=t,this.willUpdate=!0}walk(t){t(this);for(let e of this.children)e.walk(t)}connect(t){var e;(e=this.init)==null||e.call(this),this.parent!==t&&H(this),this.parent=t,this.willMount=!0,this.parent&&this.parent.children.indexOf(this)<0&&this.parent.children.push(this),this.build&&(this.children=this.build(this.children));for(let i of this.children)i.connect(this)}disconnect(){this.willDestroy=!0;for(let t of this.children)t.disconnect()}};function H(s){if(!s.parent)return;let t=s.parent.children;s.parent=void 0;let e=t.indexOf(s);e>=0&&t.splice(e,1)}var S=Object.defineProperty,W=(s,t,e)=>t in s?S(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,p=(s,t,e)=>(W(s,typeof t!="symbol"?t+"":t,e),e);function B(s){var t,e;let{nodes:i}=s;i.beforeMount.length=0,i.mount.length=0,i.beforeUpdate.length=0,i.update.length=0,i.beforeTick.length=0,i.tick.length=0,i.afterTick.length=0,i.destroy.length=0,i.afterDestroy.length=0,s.walk(n=>{n.willMount&&i.beforeMount.push(n),n.willMount&&n.mount&&i.mount.push(n),n.willUpdate&&n.beforeUpdate&&i.beforeUpdate.push(n),n.willUpdate&&i.update.push(n),n.willTick&&n.beforeTick&&i.beforeTick.push(n),n.willTick&&n.tick&&i.tick.push(n),n.willTick&&n.afterTick&&i.afterTick.push(n),n.willDestroy&&n.destroy&&i.destroy.push(n),n.willDestroy&&i.afterDestroy.push(n)});for(let n of i.beforeMount)n.beforeMount();for(let n of i.mount)n.mount(s);for(let n of i.beforeMount)n.willMount=!1,n.willDestroy=!1,n.willTick=!0;for(let n of i.beforeUpdate)(t=n.beforeUpdate)==null||t.call(n,n.updatedProps,s);for(let n of i.update)n.props||(n.props={}),Object.assign(n.props,n.updatedProps),(e=n.update)==null||e.call(n,n.updatedProps,s),n.willUpdate=!1,n.updatedProps={};for(let n of i.beforeTick)n.beforeTick(s);for(let n of i.tick)n.tick(s);for(let n of i.afterTick)n.afterTick(s);for(let n of i.destroy)n.destroy(s);for(let n of i.afterDestroy)n.afterDestroy();for(let n of i.afterDestroy)n.willMount=!1,n.willDestroy=!1,n.willTick=!1}var E=class extends c{constructor(t){super(void 0,t),p(this,"running",!1),p(this,"paused",!1),p(this,"time"),p(this,"lastTime"),p(this,"deltaTime",0),p(this,"elapsedTime",0),p(this,"lastFrame"),p(this,"scheduledTasks",[]),p(this,"unscheduledTasks",[]),p(this,"nodes",{beforeMount:[],mount:[],beforeUpdate:[],update:[],beforeTick:[],tick:[],afterTick:[],destroy:[],afterDestroy:[]}),p(this,"frame",e=>{this.lastTime=this.time??e,this.time=e,this.deltaTime=this.time-this.lastTime,this.paused||(this.elapsedTime+=this.deltaTime,this.runTasks(),this.cleanTasks()),this.running&&this.requestNextTick()})}start(){this.running||(this.paused=!1,this.running=!0,this.connect(),this.schedule(()=>B(this),{repeat:1/0}),this.requestNextTick(),this.dispatch("start",this))}stop(){this.running&&(this.paused=!1,this.disconnect(),this.schedule(()=>{this.running=!1,this.cancelLastTick(),this.reset(),this.dispatch("stop",this)}))}play(){this.paused=!1,this.dispatch("play",this)}pause(){this.paused=!0,this.dispatch("pause",this)}schedule(t,e={}){let i={task:t,delay:e.delay||0,duration:e.duration||0,repeat:e.repeat||1,startTime:this.elapsedTime,lastTime:this.elapsedTime,cycles:0,calls:0};return this.scheduledTasks.push(i),i}unschedule(t){this.unscheduledTasks.push(t)}timeSince(t){return this.elapsedTime-t}requestNextTick(){this.lastFrame=R(this.frame)}cancelLastTick(){this.lastFrame&&$(this.lastFrame)}runTasks(){for(let t of this.scheduledTasks){let{task:e,delay:i,duration:n,repeat:u,cycles:l,lastTime:f}=t;if(l>=u){this.unschedule(t);continue}this.elapsedTime-f>=i&&(e(this,t),t.calls+=1),f+i+n-this.elapsedTime<=0&&(t.cycles+=1,t.lastTime=this.elapsedTime)}}cleanTasks(){for(let t of this.unscheduledTasks){let e=this.scheduledTasks.indexOf(t);e<0||this.scheduledTasks.splice(e,1)}this.unscheduledTasks.length=0}reset(){this.time=void 0,this.lastTime=void 0,this.deltaTime=0,this.elapsedTime=0,this.scheduledTasks.length=0}};function R(s){return C()?window.requestAnimationFrame(s):setTimeout(()=>s(performance.now()),0)}function $(s){return C()?window.cancelAnimationFrame(s):clearTimeout(s)}function C(){return typeof window===void 0?!1:"requestAnimationFrame"in window}var q=Object.defineProperty,V=(s,t,e)=>t in s?q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,O=(s,t,e)=>(V(s,typeof t!="symbol"?t+"":t,e),e),v=class extends c{constructor(){super(...arguments),O(this,"tag"),O(this,"container"),O(this,"element")}init(){var t,e,i;(t=this.props)!=null&&t.tag&&(this.tag=(e=this.props)==null?void 0:e.tag),this.container=(i=this.props)==null?void 0:i.container,this.element=this.createElement()}beforeMount(){var t,e;super.beforeMount(),this.applyProps(),this.container||(this.container=((t=this.closest(v))==null?void 0:t.element)??document.body),(e=this.container)==null||e.append(this.element)}beforeUpdate(){this.removeEventListeners()}update(){this.applyProps()}afterDestroy(){super.afterDestroy(),this.removeEventListeners(),this.element.remove()}setAttribute(t,e){let i;typeof t=="boolean"?i=e?"":void 0:e!=null&&(i=String(e)),i?this.element.setAttribute(t,i):this.element.removeAttribute(t)}applyProps(){for(let t in this.props)_(t)?this.element.addEventListener(t.slice(1),this.props[t]):Y(t)?this.element[t.slice(1)]=this.props[t]:G(t)&&this.setAttribute(t,this.props[t])}removeEventListeners(){for(let t in this.props)t[0]==="$"&&this.element.removeEventListener(t.slice(1),this.props[t])}};function Y(s){return s[0]==="_"}function _(s){return s[0]==="$"}function G(s){return s!=="ref"}var y=class extends v{createElement(){return document.createElement(this.tag??"div")}};function X(s,t,e){return new y({tag:s,...t},e)}var Z=Object.defineProperty,z=(s,t,e)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,L=(s,t,e)=>(z(s,typeof t!="symbol"?t+"":t,e),e);function J(s,t){return{x:s,y:t}}var d=class{constructor(s,t=s){L(this,"x"),L(this,"y"),this.x=s,this.y=t}static of(s,t){return new d(s,t)}static from(s){return new d(s.x,s.y)}static center(s,t){return d.from(s).add(d.from(t).scale(1/2))}static origin(s,t){return d.from(s).sub(d.from(t).scale(1/2))}static normal(s,t){let e=t.x-s.x,i=t.y-s.y;return d.of(-i,e).unit()}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(s){return this.x*s.x+this.y*s.y}cross(s){return this.x*s.y-s.x*this.y}equals(s){return this.x===s.x&&this.y===s.y}is(s,t=s){return this.x===s&&this.y===t}apply(s,t=s){return this.x=s(this.x),this.y=t(this.y),this}coords(){return{x:this.y,y:this.y}}unit(){return d.from(this).scale(1/this.norm())}project(s){let t=this.dot(s),e=s.dot(s);return s.scale(t/e)}copy(s){return this.x=s.x,this.y=s.y,this}set(s,t=s){return this.x=s,this.y=t,this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this}clamp(s,t){return this.max(s).min(t)}add(s){return this.x+=s.x,this.y+=s.y,this}sub(s){return this.x-=s.x,this.y-=s.y,this}mul(s){return this.x*=s.x,this.y*=s.y,this}div(s){return this.x/=s.x,this.y/=s.y,this}translate(s,t=s){return this.x+=s,this.y+=t,this}scale(s,t=s){return this.x*=s,this.y*=t,this}rotate(s,t=d.ZERO){let e=this.x-t.x,i=this.y-t.y,n=Math.cos(s),u=Math.sin(s);return this.x=n*e-u*i+t.x,this.y=u*e+n*i+t.y,this}},r=d;L(r,"ZERO",Object.freeze({x:0,y:0}));var Q=Object.defineProperty,tt=(s,t,e)=>t in s?Q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,a=(s,t,e)=>(tt(s,typeof t!="symbol"?t+"":t,e),e),T=class extends y{constructor(){super(...arguments),a(this,"tag","canvas"),a(this,"ctx"),a(this,"width"),a(this,"height")}init(){var t,e;super.init(),this.ctx=this.element.getContext("2d"),this.width=((t=this.props)==null?void 0:t.width)??window.innerWidth,this.height=((e=this.props)==null?void 0:e.height)??window.innerHeight}clearCanvas(){this.ctx.clearRect(0,0,this.width,this.height)}},A=class extends c{constructor(){super(...arguments),a(this,"position"),a(this,"fill"),a(this,"stroke"),a(this,"canvas")}init(){var t,e,i;this.position=((t=this.props)==null?void 0:t.position)??r.of(0),this.fill=(e=this.props)==null?void 0:e.fill,this.stroke=(i=this.props)==null?void 0:i.stroke}beforeMount(){if(super.beforeMount(),this.canvas=this.closest(T),!this.canvas)throw new Error("Parent canvas not found")}tick(){var t;let e=this.canvas.ctx;this.fill&&(e.fillStyle=this.fill),this.stroke&&(e.strokeStyle=this.stroke),(t=this.paint)==null||t.call(this,this.canvas.ctx)}},w=class extends c{constructor(){super(...arguments),a(this,"position"),a(this,"dimensions"),a(this,"static"),a(this,"colliding"),a(this,"adjustments")}init(){var t,e,i;this.position=((t=this.props)==null?void 0:t.position)??r.of(0),this.dimensions=((e=this.props)==null?void 0:e.dimensions)??r.of(0),this.static=((i=this.props)==null?void 0:i.static)??!1,this.colliding=!1,this.adjustments=[]}tick(t){if(this.colliding=!1,this.static)return;let e=t.findAll(w),i=this.checkCollisions(e);for(let n of i)this.position.add(n)}checkCollisions(t){this.adjustments.length=0;for(let e of t){if(this===e||!this.hasOverlap(e))continue;this.colliding=!0,e.colliding=!0,this.dispatchCollision(e);let i=this.getOverlapAdjustment(e);this.adjustments.push(i)}return this.adjustments}dispatchCollision(t){this.dispatch("collision",t)}subscribeCollision(t){this.subscribe("collision",t)}unsubscribeCollision(t){this.unsubscribe("collision",t)}hasOverlap(t){let e=r.from(this.dimensions).scale(.5),i=r.from(this.position).sub(e),n=r.from(this.position).add(e),u=r.from(t.dimensions).scale(1/2),l=r.from(t.position).sub(u),f=r.from(t.position).add(u);return i.x<f.x&&n.x>l.x&&i.y<f.y&&n.y>l.y}getOverlapAdjustment(t){let e=r.of(0),i=r.from(this.position).sub(t.position),n=r.from(i).apply(Math.abs),u=r.from(this.dimensions).add(t.dimensions).scale(1/2),l=r.from(u).sub(n);return l.x<l.y?e.x=Math.sign(i.x)*l.x:e.y=Math.sign(i.y)*l.y,e}};var M=class extends v{createElement(){return document.createElementNS("http://www.w3.org/2000/svg",this.tag??"svg")}};function st(s,t,e){return new M({tag:s,...t},e)}var et=Object.defineProperty,it=(s,t,e)=>t in s?et(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,o=(s,t,e)=>(it(s,typeof t!="symbol"?t+"":t,e),e),b=class extends c{constructor(){super(...arguments),o(this,"element"),o(this,"parentInput"),o(this,"action"),o(this,"actions",{}),o(this,"buttons",{}),o(this,"dispatchInput",(t,e)=>{var i;this.dispatch("input",t,e),(i=this.parentInput)==null||i.dispatchInput(t,e)}),o(this,"subscribeInput",t=>{this.subscribe("input",t)}),o(this,"unsubscribeInput",t=>{this.unsubscribe("input",t)}),o(this,"clearInput",()=>{this.action=void 0,this.buttons={}})}beforeMount(){var t,e;super.beforeMount(),this.parentInput=this.closest(b),this.element=((t=this.parentInput)==null?void 0:t.element)??((e=this.closest(y))==null?void 0:e.element),this.element.addEventListener("blur",this.clearInput)}afterDestroy(){this.element.removeEventListener("blur",this.clearInput)}press(t){this.buttons[t]=!0}release(t){delete this.buttons[t]}dispatchAction(t,e){this.action=t,this.dispatchInput(t,e),this.action=void 0}isAction(t,e){if(t in this.actions)return this.actions[t](this,e);if(this.action===t&&this.hasButtons(e))return!0;for(let i of this.getAll(b))if(i.isAction(t,e))return!0;return!1}isActive(){for(let t in this.buttons)if(this.buttons[t])return!0;return!1}hasButtons(t){return t?t.every(e=>this.buttons[e]):!0}},g=class extends b{constructor(){super(...arguments),o(this,"onKeyDown",s=>{s.repeat||(this.press(s.key),this.dispatchAction(g.DOWN,s.key)),this.action=g.HOLD}),o(this,"onKeyUp",s=>{this.dispatchAction(g.UP,s.key),this.release(s.key),this.isActive()&&(this.action=g.HOLD)})}beforeMount(){super.beforeMount(),this.element.tabIndex=0,this.element.focus(),this.element.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}afterDestroy(){super.afterDestroy(),this.element.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},D=g;o(D,"DOWN","KEYBOARD_DOWN"),o(D,"HOLD","KEYBOARD_HOLD"),o(D,"UP","KEYBOARD_UP");var x=class extends b{constructor(){super(...arguments),o(this,"position",r.of(0)),o(this,"travel",r.of(0)),o(this,"wheel",r.of(0)),o(this,"onMouseDown",s=>{let t=N(s);this.press(t),this.dispatchAction(x.DOWN,t),this.action=x.HOLD}),o(this,"onMouseMove",s=>{let t=this.element.getBoundingClientRect(),e=r.from(this.position);this.position.set(s.pageX-t.x,s.pageY-t.y),this.travel.copy(this.position).sub(e)}),o(this,"onMouseUp",s=>{let t=N(s);this.dispatchAction(x.UP,t),this.release(t),this.isActive()&&(this.action=x.HOLD)}),o(this,"onWheel",s=>{this.wheel.set(s.deltaX,s.deltaY),this.dispatchAction(x.WHEEL),this.wheel.set(0),this.isActive()&&(this.action=x.HOLD)}),o(this,"onContextMenu",s=>{s.preventDefault(),s.stopPropagation()})}beforeMount(){super.beforeMount(),this.element.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("wheel",this.onWheel),this.element.addEventListener("contextmenu",this.onContextMenu)}afterDestroy(){super.afterDestroy(),this.element.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("wheel",this.onWheel),this.element.removeEventListener("contextmenu",this.onContextMenu)}isActive(){for(let s in this.buttons)if(this.buttons[s])return!0;return!1}},h=x;o(h,"DOWN","MOUSE_DOWN"),o(h,"HOLD","MOUSE_HOLD"),o(h,"UP","MOUSE_UP"),o(h,"WHEEL","MOUSE_WHEEL"),o(h,"LEFT","MouseLeft"),o(h,"MIDDLE","MouseMiddle"),o(h,"RIGHT","MouseRight"),o(h,"BACK","MouseBack"),o(h,"FORWARD","MouseForward");function N(s){switch(s.button){case 0:return h.LEFT;case 1:return h.MIDDLE;case 2:return h.RIGHT;case 3:return h.BACK;case 4:return h.FORWARD;default:return"unknown"}}var nt=Object.defineProperty,ot=(s,t,e)=>t in s?nt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,U=(s,t,e)=>(ot(s,typeof t!="symbol"?t+"":t,e),e),P=class{constructor(t="Benchmark"){U(this,"t0"),U(this,"title"),U(this,"steps"),this.t0=performance.now(),this.title=t,this.steps=[]}step(t,e){let i=performance.now();this.steps.push([i,t,e])}done(){console.log(`=== ${this.title} ===`);for(let e=0;e<this.steps.length;e++){let[i]=e===0?this.steps[0]:this.steps[e-1],[n,u,l]=this.steps[e],f=n-i,j=`[${f.toFixed(3)}ms]`,I="";l&&(I=`(${(l/f).toFixed(0)}ops/ms)`),console.log(`${j} ${u} ${I}`.trim())}let t=(performance.now()-this.t0).toFixed(3);console.log(`=== Done in ${t} ===`),console.log(`
`),this.steps.length=0}};export{w as BBox,T as Canvas,v as Dom,k as Emitter,y as Html,b as Input,D as Keyboard,E as Loop,h as Mouse,c as Node,P as Perf,A as Shape,M as Svg,r as Vec2,X as html,J as point,st as svg};
//# sourceMappingURL=vroum.js.map